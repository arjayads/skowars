<% provide(:title, 'Profile') %>

<div class="container">
  <% if flash[:success] %>
    <div class="alert alert-success"><%= flash[:success] %></div>
  <% elsif flash[:danger] %>
      <div class="alert alert-danger"><%= flash[:danger] %></div>
  <%end %>

  <!-- Modal -->
  <div class="modal fade" id="prof-pic-setter-modal" tabindex="-1" role="dialog" aria-labelledby="prof-pic-setter-label">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="prof-pic-setter-Label">Change profile picture</h4>
        </div>
        <div class="modal-body">
          <div class="container">
            <div class="row">
              <div class="col-md-4">
                <div class="img-container">
                  <img src="/assets/sample.jpg" alt="Picture">
                </div>
              </div>
              <div class="col-md-5">
                <h2>Preview</h2>
                <div class="docs-preview clearfix">
                  <div class="img-preview preview-lg"></div>
                  <div class="img-preview preview-lg img-circle"></div>
                </div>
                <label class="btn btn-primary btn-upload" for="inputImage" title="Upload image file">Upload picture
                  <input class="sr-only" id="inputImage" name="file" type="file" accept="image/*">
                </label>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" id="getDataURL" data-toggle="tooltip" data-dismiss="modal" type="button" title="">Save changes</button>
        </div>
      </div>
    </div>
  </div>

    <div class="row">
      <div class="col-md-2" style="cursor: pointer">
        <img alt="Profile pic" id="profpic" src="http://lorempixel.com/140/140/" class="img-thumbnail"/>
        <span id="profpic-modal-trigger" data-toggle="modal" data-target="#prof-pic-setter-modal"><i class="fa fa-camera"></i></span>
      </div>
      <div class="col-md-4">
        <h2 style="margin-top: 0; text-transform: capitalize"><%= current_user.first_name %></h2>
        <p>Lives in Cebu City Philippines</p>
        <span>100k friends | 23k views</span>
        <p></p>
      </div>
      <div class="col-md-6" >
        <div style="display:table; height: 150px">
            <blockquote>Look at the sparrows; they do not know what they will do in the next moment. Let us literally live from moment to moment.</blockquote>
        </div>
      </div>
    </div>
    <div class="row" style="margin-top: 10px;">
      <div class="col-md-12">
        <ul class="nav nav-tabs">
          <li class="active">
            <a href="#">About</a>
          </li>
          <li>
            <a href="#">Activities</a>
          </li>
          <li>
            <a href="#">Photos</a>
          </li>
          <li>
            <a href="#">Reviews</a>
          </li>
        </ul>
      </div>
    </div>
    <div class="row" style="margin-top: 20px;">
      <div class="col-md-6">
        <div class="panel panel-danger">
          <div class="panel-heading">
            <h3 class="panel-title">
              Basic Information
            </h3>
          </div>
          <div class="panel-body">
            <div class="row">
              <div class="col-md-3"><span class="prof-label">Looking for</span></div>
              <div class="col-md-9">Skowars</div>
            </div>
            <div class="row prof-top-pad">
              <div class="col-md-3"><span class="prof-label">Gender</span></div>
              <div class="col-md-9">Male</div>
            </div>
            <div class="row prof-top-pad">
              <div class="col-md-3"><span class="prof-label">Relationship</span></div>
              <div class="col-md-9">Seeing anyone</div>
            </div>
            <div class="row prof-top-pad">
              <div class="col-md-3"><span class="prof-label">Birthday</span></div>
              <div class="col-md-9">April 18, 1987</div>
            </div>
            <div style="margin-top: 18px;"></div>
            <i title="Edit" class="fa fa-pencil-square-o prof-edit"></i>
          </div>
        </div>
        <div class="panel panel-info">
          <div class="panel-heading">
            <h3 class="panel-title">
              Interests
            </h3>
          </div>
          <div class="panel-body">
            <ul class="list-inline">
              <li class="label label-default interest">Party</li>
              <li class="label label-default interest">Dogs</li>
              <li class="label label-default interest">Girls</li>
              <li class="label label-default interest">Travelling</li>
              <li class="label label-default interest">Beer</li>
              <li class="label label-default interest">Programming</li>
              <li class="label label-default interest">Sports</li>
              <li class="label label-default interest">Community service</li>
            </ul>
            <i title="Edit" class="fa fa-pencil-square-o prof-edit"></i>
          </div>
        </div>
        <div class="panel panel-success">
          <div class="panel-heading">
            <h3 class="panel-title">
              Contact Information
            </h3>
          </div>
          <div class="panel-body">
            <div class="row">
              <div class="col-md-3"><span class="prof-label">Mobile</span></div>
              <div class="col-md-9">+63 912354553</div>
            </div>
            <div class="row prof-top-pad">
              <div class="col-md-3"><span class="prof-label">Email</span></div>
              <div class="col-md-9">xmen@marvel.net</div>
            </div>
            <div class="row prof-top-pad">
              <div class="col-md-3"><span class="prof-label">Skype</span></div>
              <div class="col-md-9">wazlo143</div>
            </div>
            <div class="row prof-top-pad">
              <div class="col-md-3"><span class="prof-label">Facebook</span></div>
              <div class="col-md-9">www.facebook.com/koncen</div>
            </div>
            <div style="margin-top: 18px;"></div>
            <i title="Edit" class="fa fa-pencil-square-o prof-edit"></i>
          </div>
        </div>
        <div class="panel panel-warning">
          <div class="panel-heading">
            <h3 class="panel-title">
              Pending requests
            </h3>
          </div>
          <div class="panel-body">
            <ul class="list-inline">
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
            </ul>
            <div style="margin-top: 18px;"></div>
            <i title="View all" class="fa fa-search"></i>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="panel panel-danger">
          <div class="panel-heading">
            <h3 class="panel-title">
              Recently added friends
            </h3>
          </div>
          <div class="panel-body">
            <ul class="list-inline">
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
            </ul>
            <div style="margin-top: 18px;"></div>
            <i title="View all" class="fa fa-search"></i>
          </div>
        </div>
        <div class="panel panel-info">
          <div class="panel-heading">
            <h3 class="panel-title">
              My Recent Sponsors
            </h3>
          </div>
          <div class="panel-body">
            <ul class="list-inline">
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
            </ul>
            <div style="margin-top: 18px;"></div>
            <i title="View all" class="fa fa-search"></i>
          </div>
        </div>
        <div class="panel panel-success">
          <div class="panel-heading">
            <h3 class="panel-title">
              My Recent Skowars
            </h3>
          </div>
          <div class="panel-body">
            <ul class="list-inline">
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
              <li class="prof-thumb"><img alt="Profile pic" src="http://lorempixel.com/140/140/" class="img-thumbnail" /></li>
            </ul>
            <div style="margin-top: 18px;"></div>
            <i title="View all" class="fa fa-search"></i>
          </div>
        </div>
      </div>
    </div>
</div>

<link  href="https://cdnjs.cloudflare.com/ajax/libs/cropper/0.7.9/cropper.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropper/0.7.9/cropper.min.js"></script>

<script>

    $(function () {

        'use strict';

        var console = window.console || { log: function () {} },
                $alert = $('.docs-alert'),
                $message = $alert.find('.message'),
                showMessage = function (message, type) {
                    $message.text(message);

                    if (type) {
                        $message.addClass(type);
                    }

                    $alert.fadeIn();

                    setTimeout(function () {
                        $alert.fadeOut();
                    }, 3000);
                };

        (function () {

            var $image = $('.img-container > img'),
                    cropBoxData,
                    canvasData,
                    options = {
                        responsive: true,
                        autoCropArea: 0.80,
                        dragCrop: false,
                        touchDragZoom: false,
                        aspectRatio: 9 / 9,
                        preview: '.img-preview',
                        built: function () {
                            // Strict mode: set crop box data first
                            $image.cropper('setCropBoxData', cropBoxData);
                            $image.cropper('setCanvasData', canvasData);
                        }
                    };


            $('#profpic-modal-trigger').click(function () {
                $image.cropper(options);
            });

            var $profpic = $("#profpic");
            $("#getDataURL").click(function () {

                cropBoxData = $image.cropper('getCropBoxData');
                canvasData = $image.cropper('getCanvasData');
                var imageData = $image.cropper("getDataURL", "image/jpeg");

                var AUTH_TOKEN = $('meta[name=csrf-token]').attr('content');

                $.ajax('/member/change-profile-pic', {
                    method: "POST",
                    data: {"imageData": imageData, "authenticity_token": AUTH_TOKEN},
                    success: function (o) {

                        $image.cropper('destroy');
                    },
                    error: function () {
                        console.log('Upload error');
                    }
                });
            });

            // Import image
            var $inputImage = $('#inputImage'),
                    URL = window.URL || window.webkitURL,
                    blobURL;

            if (URL) {
                $inputImage.change(function () {
                    var files = this.files,
                            file;

                    if (!$image.data('cropper')) {
                        return;
                    }

                    if (files && files.length) {
                        file = files[0];

                        if (/^image\/\w+$/.test(file.type)) {
                            blobURL = URL.createObjectURL(file);
                            $image.one('built.cropper', function () {
                                URL.revokeObjectURL(blobURL); // Revoke when load complete
                            }).cropper('reset').cropper('replace', blobURL);
                            $inputImage.val('');
                        } else {
                            showMessage('Please choose an image file.');
                        }
                    }
                });
            } else {
                $inputImage.parent().remove();
            }

        }());

    });
</script>
